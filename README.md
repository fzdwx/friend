# Friend

ä¸€ä¸ªç°ä»£åŒ–çš„ AI ç¼–ç¨‹åŠ©æ‰‹æ¡Œé¢åº”ç”¨ï¼Œæä¾›æµç•…çš„å¯¹è¯ä½“éªŒå’Œå¼ºå¤§çš„å·¥å…·è°ƒç”¨èƒ½åŠ›ã€‚

**åŸºäº Tauri + React æ„å»ºè·¨å¹³å°æ¡Œé¢åº”ç”¨ï¼ŒBun + Elysia æ„å»ºé«˜æ€§èƒ½åç«¯**

<div align="center">

![Static Badge](https://img.shields.io/badge/Bun-1.0+-black?logo=bun)
![Static Badge](https://img.shields.io/badge/React-19-blue?logo=react)
![Static Badge](https://img.shields.io/badge/Tauri-2.0-FFC131?logo=tauri)
![Static Badge](https://img.shields.io/badge/Tailwind-4-38BDF8?logo=tailwindcss)
![License](https://img.shields.io/badge/License-MIT-green)

</div>

## âœ¨ ç‰¹æ€§

### ğŸ¤– AI èƒ½åŠ›
- **å¤šæ¨¡å‹æ”¯æŒ** - åŸç”Ÿæ”¯æŒ OpenAIã€Anthropicï¼Œå¯é…ç½®ä»»æ„ OpenAI-compatible ç«¯ç‚¹
- **æµå¼å¯¹è¯** - åŸºäº SSE çš„å®æ—¶æµå¼ä¼ è¾“ï¼Œé›¶å»¶è¿Ÿçœ‹åˆ° AI æ€è€ƒå’Œå›å¤
- **æ€ç»´é“¾å¯è§†åŒ–** - ç‹¬ç«‹ Activity é¢æ¿å±•ç¤º AI æ€è€ƒè¿‡ç¨‹å’Œå·¥å…·è°ƒç”¨
- **ä¼šè¯ç®¡ç†** - åˆ›å»ºã€åˆ‡æ¢ã€åˆ é™¤ä¼šè¯ï¼Œè‡ªåŠ¨æŒä¹…åŒ–èŠå¤©è®°å½•
- **è‡ªå®šä¹‰å·¥å…·** - æ‰©å±• AI èƒ½åŠ›ï¼Œå½“å‰æä¾› 4 ä¸ªä¸»é¢˜ç®¡ç†å·¥å…·

### ğŸ¨ ä¸»é¢˜ç³»ç»Ÿ
- **15 ç»„å†…ç½®ä¸»é¢˜** - 5 ç»„äº®è‰² + 10 ç»„æš—è‰²ç²¾å¿ƒè®¾è®¡çš„é…è‰²æ–¹æ¡ˆ
- **oklch é¢œè‰²ç©ºé—´** - ç°ä»£æ„ŸçŸ¥å‡åŒ€é¢œè‰²ï¼Œè‰²å½©è½¬æ¢æ›´è‡ªç„¶
- **AI ç”Ÿæˆä¸»é¢˜** - åŸºäºè‰²ç›¸å’Œé¥±å’Œåº¦è‡ªåŠ¨ç”Ÿæˆå’Œè°é…è‰²
- **å®æ—¶é¢„è§ˆ** - ä¸»é¢˜åˆ‡æ¢å³æ—¶ç”Ÿæ•ˆï¼Œæ‰€è§å³æ‰€å¾—
- **å¯¼å…¥/å¯¼å‡º** - JSON æ ¼å¼ä¸»é¢˜é…ç½®ï¼Œæ–¹ä¾¿åˆ†äº«

### ğŸ› ï¸ å·¥å…·è°ƒç”¨
- **æ–‡ä»¶è¯»å†™** - è¯»å–ã€å†™å…¥ã€æœç´¢æ–‡ä»¶å†…å®¹
- **Bash æ‰§è¡Œ** - è¿è¡Œå‘½ä»¤å¹¶æ•è·è¾“å‡º
- **è‡ªå®šä¹‰ Provider** - æ·»åŠ ç¬¬ä¸‰æ–¹ AI æ¨¡å‹æœåŠ¡
- **ä¸»é¢˜ç®¡ç†å·¥å…·** - é€šè¿‡ AI å¯¹è¯æ“ä½œä¸»é¢˜ç³»ç»Ÿ
    - `get_themes` - æŸ¥è¯¢å¯ç”¨ä¸»é¢˜
    - `generate_theme` - AI ç”Ÿæˆè‡ªå®šä¹‰ä¸»é¢˜
    - `set_theme` - åˆ‡æ¢ä¸»é¢˜
    - `add_custom_provider` - æ·»åŠ æ¨¡å‹æä¾›å•†

### ğŸ–¥ï¸ æ¡Œé¢åº”ç”¨
- **è·¨å¹³å°** - Windowsã€macOSã€Linux åŸç”Ÿåº”ç”¨
- **ç‹¬ç«‹çª—å£** - 1280x800 é»˜è®¤çª—å£ï¼Œå¯è‡ªå®šä¹‰
- **ç³»ç»Ÿé›†æˆ** - åŸç”Ÿèœå•ã€é€šçŸ¥ã€æ–‡ä»¶è®¿é—®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- [Bun](https://bun.sh) 1.0+
- [Rust](https://rustup.rs/) ï¼ˆç”¨äº Tauri æ¡Œé¢åº”ç”¨ï¼‰
- Node.js 18+ ï¼ˆå¯é€‰ï¼ŒBun å·²å†…ç½®ï¼‰

### å®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/fzdwx/friend.git
cd friend

# å®‰è£…ä¾èµ–
bun install

# åˆå§‹åŒ–æ•°æ®åº“
just db-generate
just db-push
```

### å¼€å‘

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåç«¯ + å‰ç«¯ï¼‰
just dev

# æˆ–è€…åˆ†åˆ«å¯åŠ¨
just dev-server  # åç«¯: http://localhost:3001
just dev-app     # å‰ç«¯: http://localhost:5173

# å¯åŠ¨æ¡Œé¢åº”ç”¨ï¼ˆéœ€å…ˆå¯åŠ¨ dev-serverï¼‰
just dev-tauri
```

### æ„å»º

```bash
# æ„å»ºå‰ç«¯
just build-app

# æ„å»ºæ¡Œé¢åº”ç”¨
just build-tauri
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ shared/              # ç±»å‹å®šä¹‰å’Œå…±äº«ä»£ç 
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ models.ts    # Session, Message, Model ç±»å‹
â”‚   â”‚       â”œâ”€â”€ api.ts       # API è¯·æ±‚/å“åº”ç±»å‹
â”‚   â”‚       â”œâ”€â”€ events.ts    # SSE äº‹ä»¶ç±»å‹
â”‚   â”‚       â””â”€â”€ themes.ts    # 15 ç»„å†…ç½®ä¸»é¢˜é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ server/              # Elysia API åç«¯
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ agent/
â”‚   â”‚       â”‚   â”œâ”€â”€ manager.ts    # AgentManager æ ¸å¿ƒ
â”‚   â”‚       â”‚   â””â”€â”€ tools/        # è‡ªå®šä¹‰å·¥å…· â­
â”‚   â”‚       â”‚       â”œâ”€â”€ index.ts
â”‚   â”‚       â”‚       â”œâ”€â”€ custom-provider-add.ts
â”‚   â”‚       â”‚       â”œâ”€â”€ theme-get.ts
â”‚   â”‚       â”‚       â”œâ”€â”€ theme-generate.ts
â”‚   â”‚       â”‚       â”œâ”€â”€ theme-set.ts
â”‚   â”‚       â”‚       â””â”€â”€ theme-utils.ts
â”‚   â”‚       â”œâ”€â”€ routes/
â”‚   â”‚       â”‚   â”œâ”€â”€ sessions.ts   # ä¼šè¯ CRUD
â”‚   â”‚       â”‚   â”œâ”€â”€ models.ts     # æ¨¡å‹åˆ—è¡¨
â”‚   â”‚       â”‚   â”œâ”€â”€ config.ts     # é…ç½®ç®¡ç†
â”‚   â”‚       â”‚   â””â”€â”€ events.ts     # SSE æµ
â”‚   â”‚       â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ app/                 # React + Vite + Tauri å‰ç«¯
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ components/
â”‚   â”‚       â”‚   â”œâ”€â”€ layout/       # Sidebar, ChatPanel, ActivityPanel
â”‚   â”‚       â”‚   â”œâ”€â”€ chat/         # MessageList, InputArea, ThinkingBlock
â”‚   â”‚       â”‚   â”œâ”€â”€ activity/     # TurnGroup, StreamingTurn â­
â”‚   â”‚       â”‚   â”œâ”€â”€ config/       # ProviderSettings, AppearanceSettings
â”‚   â”‚       â”‚   â””â”€â”€ ModelSelector.tsx
â”‚   â”‚       â”œâ”€â”€ stores/           # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ hooks/            # useSSE, useApi, useSession
â”‚   â”‚       â”œâ”€â”€ lib/
â”‚   â”‚       â”‚   â”œâ”€â”€ api.ts        # API å®¢æˆ·ç«¯
â”‚   â”‚       â”‚   â”œâ”€â”€ theme.ts      # ä¸»é¢˜å·¥å…·å‡½æ•°
â”‚   â”‚       â”‚   â””â”€â”€ colors.ts     # oklch é¢œè‰²è½¬æ¢
â”‚   â”‚       â””â”€â”€ styles/
â”‚   â”‚           â””â”€â”€ globals.css   # Tailwind v4 + oklch å˜é‡
â”‚   â”‚
â”‚   â””â”€â”€ db/                  # Prisma + SQLite
â”‚       â””â”€â”€ prisma/
â”‚           â””â”€â”€ schema.prisma     # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”‚
â”œâ”€â”€ justfile                  # ä»»åŠ¡å‘½ä»¤å®šä¹‰
â””â”€â”€ package.json              # Bun workspaces é…ç½®
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯
- **Runtime**: [Bun](https://bun.sh) - é«˜æ€§èƒ½ JavaScript è¿è¡Œæ—¶
- **Framework**: [Elysia](https://elysiajs.com) - æé€Ÿ TypeScript æ¡†æ¶
- **AI SDK**: [@mariozechner/pi-coding-agent](https://github.com/badlogic/pi-mono)
- **Database**: SQLite + [Prisma](https://prisma.io) ORM
- **Stream**: Server-Sent Events (SSE)

### å‰ç«¯
- **Framework**: React 19
- **Build Tool**: Vite 6
- **Desktop**: [Tauri v2](https://tauri.app)
- **Styling**: Tailwind CSS v4 + oklch é¢œè‰²æ ¼å¼
- **State**: [Zustand](https://github.com/pmndrs/zustand)
- **Icons**: [Lucide React](https://lucide.dev)
- **Color System**: oklch - æ„ŸçŸ¥å‡åŒ€é¢œè‰²ç©ºé—´

### ä»£ç è´¨é‡
- **Formatter**: [oxfmt](https://github.com/oxc-project/oxc)
- **Linter**: [oxlint](https://github.com/oxc-project/oxc)
- **Type Check**: TypeScript 5.8

## ğŸ“‹ å¯ç”¨å‘½ä»¤

### å¼€å‘

```bash
just dev              # å¯åŠ¨æ‰€æœ‰æœåŠ¡
just dev-server       # ä»…åç«¯ (:3001)
just dev-app          # ä»…å‰ç«¯ (:5173)
just dev-tauri        # æ¡Œé¢åº”ç”¨
```

### ä»£ç è´¨é‡

```bash
just fmt              # æ ¼å¼åŒ– (oxfmt)
just lint             # æ£€æŸ¥ (oxlint)
just fix              # è‡ªåŠ¨ä¿®å¤
just typecheck        # TypeScript æ£€æŸ¥
```

### æ•°æ®åº“

```bash
just db-generate      # ç”Ÿæˆ Prisma Client
just db-push          # æ¨é€ schemaï¼ˆå¼€å‘ç”¨ï¼‰
just db-migrate       # åˆ›å»º migration
just db-studio        # Prisma Studio å¯è§†åŒ–ç•Œé¢
just db-reset         # é‡ç½®æ•°æ®åº“
```

### æ„å»º

```bash
just build-app        # æ„å»ºå‰ç«¯
just build-tauri      # æ„å»ºæ¡Œé¢åº”ç”¨
just clean            # æ¸…ç†æ„å»ºäº§ç‰©
```

## âš™ï¸ é…ç½®è¯´æ˜

### æ¨¡å‹é…ç½®

1. **å†…ç½®æ¨¡å‹** - è‡ªåŠ¨è¯†åˆ«ç³»ç»Ÿä¸­å·²é…ç½® API Key çš„æ¨¡å‹ï¼ˆOpenAIã€Anthropic ç­‰ï¼‰

2. **è‡ªå®šä¹‰ Provider** - æ”¯æŒæ·»åŠ ä»»æ„ OpenAI-compatible APIï¼š
    - é…ç½® API Keyã€Base URL
    - å®šä¹‰å¤šä¸ªæ¨¡å‹åŠå…¶å‚æ•°
    - æŒ‡å®š API åè®®ï¼ˆopenai-completionsã€anthropic-messages ç­‰ï¼‰

### API Key é…ç½®

åœ¨å¯åŠ¨åº”ç”¨å‰è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
export OPENAI_API_KEY="sk-..."
export ANTHROPIC_API_KEY="sk-ant-..."
```

æˆ–åœ¨åº”ç”¨å†…é€šè¿‡è‡ªå®šä¹‰ Provider é…ç½®ã€‚

### ä¸»é¢˜ç³»ç»Ÿ

#### å†…ç½®ä¸»é¢˜ï¼ˆ15 ç»„ï¼‰

**äº®è‰²ä¸»é¢˜**ï¼ˆ5 ç»„ï¼‰ï¼š
- Default Light - ç®€çº¦ç™½
- Gruvbox Light - æŸ”å’Œç±³é»„
- Solarized Light - ç»å…¸æµ…è‰²
- Catppuccin Latte - å¥¶çŒ«æ‹¿é“
- Rose Pine Dawn - ç«ç‘°æ™¨æ›¦

**æš—è‰²ä¸»é¢˜**ï¼ˆ10 ç»„ï¼‰ï¼š
- Default Dark - ç®€çº¦é»‘
- Dracula - å¾·å¤æ‹‰ç´«
- Nord - åŒ—æå…‰è“
- Gruvbox Dark - å¤æœ´æš—è‰²
- Monokai - ç»å…¸ä»£ç ç¼–è¾‘å™¨é…è‰²
- Catppuccin Mocha - å¥¶çŒ«æ‘©å¡
- Solarized Dark - ç»å…¸æ·±è‰²
- Tokyo Night - ä¸œäº¬å¤œæ™¯
- One Dark Pro - VS Code æš—è‰²
- Rose Pine Moon - ç«ç‘°æœˆè‰²

#### AI ç”Ÿæˆä¸»é¢˜

é€šè¿‡è‡ªç„¶è¯­è¨€å¯¹è¯è®© AI ä¸ºä½ åˆ›å»ºä¸»é¢˜ï¼š
```
ä½ : åˆ›å»ºä¸€ä¸ªè“è‰²çš„æš—è‰²ä¸»é¢˜
AI: (è°ƒç”¨ generate_theme å·¥å…·) å·²ç”Ÿæˆä¸»é¢˜å¹¶æ¿€æ´»
```

#### è‡ªå®šä¹‰ä¸»é¢˜

1. å¤åˆ¶ç°æœ‰ä¸»é¢˜
2. ç¼–è¾‘ 22 ä¸ªè¯­ä¹‰åŒ–é¢œè‰²å˜é‡
3. å®æ—¶é¢„è§ˆæ•ˆæœ
4. å¯¼å‡ºä¸º JSON åˆ†äº«

## ğŸ”Œ API ç«¯ç‚¹

### ä¼šè¯ç®¡ç†
```
GET    /api/sessions          # åˆ—å‡ºæ‰€æœ‰ä¼šè¯
POST   /api/sessions          # åˆ›å»ºä¼šè¯
GET    /api/sessions/:id      # è·å–ä¼šè¯è¯¦æƒ…
DELETE /api/sessions/:id      # åˆ é™¤ä¼šè¯
POST   /api/sessions/:id/prompt   # å‘é€æ¶ˆæ¯
POST   /api/sessions/:id/model    # è®¾ç½®æ¨¡å‹
POST   /api/sessions/:id/steer    # å¼•å¯¼å›å¤æ–¹å‘
POST   /api/sessions/:id/abort    # ä¸­æ–­ç”Ÿæˆ
```

### æ¨¡å‹ç®¡ç†
```
GET    /api/models            # è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨
```

### é…ç½®ç®¡ç†
```
GET    /api/config            # è·å–é…ç½®
PATCH  /api/config            # æ›´æ–°é…ç½®
GET    /api/config/providers  # è·å–è‡ªå®šä¹‰ Providers
POST   /api/config/providers  # æ·»åŠ  Provider
DELETE /api/config/providers/:name  # åˆ é™¤ Provider
```

### äº‹ä»¶æµ
```
GET    /api/events            # å…¨å±€äº‹ä»¶æµï¼ˆSSEï¼‰
GET    /api/sessions/:id/events  # ä¼šè¯äº‹ä»¶æµï¼ˆSSEï¼‰
```

**äº‹ä»¶ç±»å‹**ï¼š
- `agent_start/end` - Agent ä¼šè¯å¼€å§‹/ç»“æŸ
- `message_start/update/end` - æ¶ˆæ¯æµå¼ä¼ è¾“
- `text_delta` - æ–‡æœ¬å¢é‡
- `thinking_delta` - æ€è€ƒå¢é‡
- `tool_call_start/end` - å·¥å…·è°ƒç”¨
- `tool_execution_start/update/end` - å·¥å…·æ‰§è¡Œ
- `error` - é”™è¯¯äº‹ä»¶

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°å·¥å…·

1. åœ¨ `packages/server/src/agent/tools/` åˆ›å»ºæ–°æ–‡ä»¶ï¼š

```typescript
// myTool.ts
import { Type } from "@sinclair/typebox";
import type { ToolDefinition } from "@mariozechner/pi-coding-agent";
import type { IAgentManager } from "./addCustomProvider.js";

export function createMyTool(manager: IAgentManager): ToolDefinition {
  return {
    name: "my_tool",
    label: "My Tool",
    description: "å·¥å…·æè¿°",
    parameters: Type.Object({
      param: Type.String({ description: "å‚æ•°è¯´æ˜" }),
    }),
    async execute(toolCallId, params, signal, onUpdate, ctx) {
      // å®ç°é€»è¾‘
      return {
        content: [{ type: "text", text: "ç»“æœ" }],
        details: undefined,
      };
    },
  };
}
```

2. åœ¨ `tools/index.ts` å¯¼å‡ºå¹¶æ·»åŠ åˆ° `AgentManager`

### ä»£ç è§„èŒƒ

- **ESM only** - æ‰€æœ‰åŒ…ä½¿ç”¨ `"type": "module"`
- **æ–‡ä»¶æ‰©å±•å** - æœ¬åœ°å¯¼å…¥ä½¿ç”¨ `.js` æ‰©å±•å
- **å‘½åè§„èŒƒ**:
    - PascalCase: ç»„ä»¶ã€ç±»å‹ã€æ¥å£
    - camelCase: å‡½æ•°ã€å˜é‡ã€hooks
    - kebab-case: ç›®å½•å

### ä¸»é¢˜å¼€å‘

**é¢œè‰²æ ¼å¼**ï¼šä½¿ç”¨ oklch
```typescript
const color: ColorDefinition = { l: 0.5, c: 0.1, h: 250 };
// l: äº®åº¦ (0-1), c: è‰²åº¦ (0-0.25), h: è‰²ç›¸ (0-360)
```

**é¢œè‰²å˜é‡**ï¼šé€šè¿‡ CSS å˜é‡åŠ¨æ€åº”ç”¨
```typescript
applyThemeToDOM(themeConfig); // åº”ç”¨åˆ° :root
```

## ğŸ¯ æ ¸å¿ƒè®¾è®¡

### Turn-based Activity ç³»ç»Ÿ

Activity é¢æ¿æŒ‰å¯¹è¯å›åˆï¼ˆTurnï¼‰å±•ç°æ€è€ƒå’Œå·¥å…·è°ƒç”¨ï¼š

- **å½“å‰å›åˆ** - å®æ—¶æ˜¾ç¤ºæµå¼ä¸­çš„æ€è€ƒè¿‡ç¨‹å’Œå·¥å…·æ‰§è¡Œ
- **å†å²å›åˆ** - æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼Œç‚¹å‡»å±•å¼€æŸ¥çœ‹è¯¦ç»†
- **è”åŠ¨æœºåˆ¶** - ç‚¹å‡»ä¸»å¯¹è¯åŒºçš„æ¶ˆæ¯ï¼Œå¯¹åº”å›åˆåœ¨ Activity é¢æ¿é«˜äº®

### è‡ªå®šä¹‰å·¥å…·æ¶æ„

```
AgentManager
    â”œâ”€â”€ addCustomProvider    - æ·»åŠ  AI æä¾›å•†
    â”œâ”€â”€ getThemes           - è·å–ä¸»é¢˜åˆ—è¡¨
    â”œâ”€â”€ generateTheme       - AI ç”Ÿæˆä¸»é¢˜
    â””â”€â”€ setTheme            - åˆ‡æ¢ä¸»é¢˜
```

æ‰€æœ‰å·¥å…·éµå¾ªç»Ÿä¸€æ¥å£ï¼Œæ˜“äºæ‰©å±•ã€‚

## ğŸ”„ æ•°æ®æµ

```
User Message
    â†“
AgentManager (Server)
    â”œâ”€ Thinking Process â†’ Activity Panel (å®æ—¶)
    â”œâ”€ Tool Call â†’ Tool Executor (Server)
    â”‚   â””â”€ Result â†’ Activity Panel
    â””â”€ Response â†’ Chat Panel (æµå¼)
```

## ğŸ¤ è´¡çŒ®
e
æ¬¢è¿æäº¤ Issue å’Œ PRï¼

## ğŸ“„ è®¸å¯è¯

MIT

## ğŸ™ è‡´è°¢

- [pi-mono](https://github.com/badlogic/pi-mono) - åº•å±‚ AI Agent SDK
- [Tauri](https://tauri.app) - æ¡Œé¢åº”ç”¨æ¡†æ¶
- [Elysia](https://elysiajs.com) - Web æ¡†æ¶
- [Bun](https://bun.sh) - JavaScript è¿è¡Œæ—¶
- [Lucide](https://lucide.dev) - å›¾æ ‡åº“
- [Tailwind CSS](https://tailwindcss.com) - CSS æ¡†æ¶

---

<div align="center">
  Made with â¤ï¸ by <a href="https://github.com/fzdwx">fzdwx</a>
</div>
